import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;
import android.webkit.WebView;
import android.webkit.WebViewClient;
import android.content.Intent;
import android.net.Uri;
import android.widget.Toast;
import android.util.Log;

// Yeh ek example Activity hai. Aapko is logic ko apne existing Activity me daalna hoga.
public class MyWebViewActivity extends AppCompatActivity {

    private WebView myWebView;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        
        // Apne layout file se WebView ko link karein
        // Yahaan R.layout.activity_main aur R.id.my_webview aapke project ke hisaab se honge
        // setContentView(R.layout.activity_main);
        // myWebView = findViewById(R.id.my_webview);

        // Upar di gayi do lines ko replace karne ke liye, hum yahaan ek naya WebView bana rahe hain
        // Agar aapke paas pehle se layout me hai, toh upar wala tareeka istemaal karein.
        myWebView = new WebView(this);
        setContentView(myWebView);


        // JavaScript enable karein (agar aapki website istemaal karti hai)
        myWebView.getSettings().setJavaScriptEnabled(true);

        // Sabse zaroori hissa: Custom WebViewClient set karna
        myWebView.setWebViewClient(new WebViewClient() {
            
            @Override
            public boolean shouldOverrideUrlLoading(WebView view, String url) {
                
                // Log karein ki kaunsa URL load ho raha hai (debug karne ke liye)
                Log.d("WebViewLog", "Loading URL: " + url);

                // Check karein ki kya URL "upi://" se shuru hota hai
                if (url != null && url.startsWith("upi://")) {
                    try {
                        // Ek naya Intent banayein (phone ko batayein ki ek app kholna hai)
                        Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(url));
                        
                        // Check karein ki kya phone me koi app hai jo is link ko khol sakta hai
                        if (intent.resolveActivity(getPackageManager()) != null) {
                            // Agar hai, toh us app (UPI app) ko kholein
                            startActivity(intent);
                        } else {
                            // Agar koi UPI app install nahi hai
                            Toast.makeText(getApplicationContext(), "Aapke phone mein koi UPI app install nahi hai.", Toast.LENGTH_SHORT).show();
                        }
                        
                        // WebView ko batayein ki humne is link ko handle kar liya hai,
                        // use is link ko load karne ki koshish nahi karni hai.
                        return true;

                    } catch (Exception e) {
                        // Agar koi error aaye
                        Log.e("WebViewLog", "UPI Intent Error: " + e.getLocalizedMessage());
                        Toast.makeText(getApplicationContext(), "Link kholne me error aaya.", Toast.LENGTH_SHORT).show();
                        return true; // Error ko bhi handled mark karein
                    }
                }
                
                // Agar yeh 'upi://' link nahi hai (jaise 'http://' ya 'https://'),
                // toh WebView ko use normal tareeke se load karne dein.
                return false;
            }
        });

        // Aakhri me, apna web app URL load karein
        // Is string "YOUR_WEBSITE_URL_HERE" ko apne actual URL se badal dein
        myWebView.loadUrl("YOUR_WEBSITE_URL_HERE"); 
        
        // Example ke liye, main aapki HTML file ko data ke roop me load kar raha hoon.
        // Asli app me aap 'loadUrl' ka istemaal karenge.
        // myWebView.loadDataWithBaseURL(null, getHtmlContent(), "text/html", "UTF-8", null);
    }
    
    // Yeh sirf is demo ke liye hai, aap isse ignore kar sakte hain
    // aur upar 'myWebView.loadUrl("YOUR_URL")' ka istemaal kar sakte hain.
    private String getHtmlContent() {
        return "<!DOCTYPE html>"
             + "<html><head><meta name='viewport' content='width=device-width, initial-scale=1.0'>"
             + "<style>body{font-family: sans-serif; display: grid; place-items: center; min-height: 90vh; text-align: center;}"
             + "a{display: inline-block; padding: 20px 40px; font-size: 1.2rem; color: white; background: #007bff; text-decoration: none; border-radius: 12px;}"
             + "</style></head>"
             + "<body>"
             + "<h3>WebView UPI Test</h3>"
             + "<a href='upi://pay?pa=8987305021@superyes&pn=Merchant&am=100&cu=INR&tn=Payment%20for%20Order'>"
             + "Click karke Pay Karein (â‚¹100)"
             + "</a>"
             + "</body></html>";
    }

    // Back button press handle karne ke liye (taaki app band na ho, page back ho)
    @Override
    public void onBackPressed() {
        if (myWebView.canGoBack()) {
            myWebView.goBack();
        } else {
            super.onBackPressed();
        }
    }
}
